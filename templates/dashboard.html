<!DOCTYPE html>
<html>
<head>
    <title>Network Traffic Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stats { grid-column: 1 / -1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .stat-card { background: #fff; padding: 15px; border-radius: 8px; text-align: center; }
        .alert { color: #d32f2f; font-weight: bold; }
        .packet { font-family: monospace; font-size: 12px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>ðŸ“Š Network Traffic Dashboard</h1>
    
    <div class="stats">
        <div class="stat-card">
            <h3>Packets (1h)</h3>
            <p id="packet-count">0</p>
        </div>
        <div class="stat-card">
            <h3>Alerts (24h)</h3>
            <p id="alert-count">0</p>
        </div>
        <div class="stat-card">
            <h3>Top IP</h3>
            <p id="top-ip">-</p>
        </div>
        <div class="stat-card">
            <h3>Status</h3>
            <p id="status">ðŸŸ¢ Live</p>
        </div>
    </div>

    <div class="dashboard">
        <div class="card">
            <h2>Recent Packets</h2>
            <div id="packets-table">
                <table>
                    <thead>
                        <tr><th>Time</th><th>Source</th><th>Destination</th><th>Port</th></tr>
                    </thead>
                    <tbody id="packets-body"></tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <h2>Recent Alerts</h2>
            <div id="alerts-table">
                <table>
                    <thead>
                        <tr><th>Time</th><th>Type</th><th>Source IP</th><th>Description</th></tr>
                    </thead>
                    <tbody id="alerts-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        async function updateDashboard() {
            try {
                // Fetch stats
                const statsResponse = await fetch('/api/stats');
                const stats = await statsResponse.json();
                
                document.getElementById('packet-count').textContent = stats.packet_count;
                document.getElementById('alert-count').textContent = stats.alert_count;
                document.getElementById('top-ip').textContent = stats.top_ips[0] ? stats.top_ips[0].src_ip : '-';
                
                // Fetch recent packets
                const packetsResponse = await fetch('/api/recent-packets');
                const packets = await packetsResponse.json();
                
                const packetsBody = document.getElementById('packets-body');
                packetsBody.innerHTML = packets.map(packet => `
                    <tr>
                        <td>${packet.timestamp.slice(11,19)}</td>
                        <td>${packet.src_ip}</td>
                        <td>${packet.dst_ip}</td>
                        <td>${packet.dport || '-'}</td>
                    </tr>
                `).join('');
                
                // Fetch recent alerts
                const alertsResponse = await fetch('/api/recent-alerts');
                const alerts = await alertsResponse.json();
                
                const alertsBody = document.getElementById('alerts-body');
                alertsBody.innerHTML = alerts.map(alert => `
                    <tr class="alert">
                        <td>${alert.timestamp.slice(11,19)}</td>
                        <td>${alert.alert_type}</td>
                        <td>${alert.src_ip}</td>
                        <td>${alert.description.slice(0,50)}...</td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }
        
        // Update every 3 seconds
        setInterval(updateDashboard, 3000);
        updateDashboard(); // Initial load
    </script>
</body>
</html>
